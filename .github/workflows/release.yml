name: Release
on:
  workflow_dispatch:
    inputs:
      version:
        type: string
        required: true
      prerelease:
        type: boolean
        default: false
      draft:
        type: boolean
        default: false
        
permissions: write-all

jobs:

  create-release:
    name: Create & Publish Release
    runs-on: ubuntu-latest
    steps:
    
      - name: Clone Repository
        uses: actions/checkout@v3
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          
      - name: Create Release
        uses: softprops/action-gh-release@v1
        with:
          name: ${{ github.event.inputs.version }}
          tag_name: ${{ github.event.inputs.version }}
          prerelease: ${{ github.event.inputs.prerelease }}
          draft: ${{ github.event.inputs.draft }}
          token: ${{ secrets.GITHUB_TOKEN }}
  
  create-docs:
    name: Create & Publish Documentation
    runs-on: ubuntu-latest
    needs: create-release
    steps:

      - name: Clone Repository
        uses: actions/checkout@v3
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Create Documentation
        run: |
          apt-get install python3
          pip install -r Docs~/requirements.txt
          jupyter-book config sphinx Docs~/
          sphinx-build Docs~/ Docs~/_build/html -b html
          
      - name: Publish Documentation
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: Docs~/_build/html
